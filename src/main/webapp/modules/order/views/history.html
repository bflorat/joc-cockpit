<div class="white box-shadow sub-header">
    <div class="row">
        <div class="col-md-12">
            <div class="padding">
                <div class="text-right ">
                    <div class="pull-left">
                        <span class="text-md text-orange _600 p-t-xs" ncy-breadcrumb></span>
                    </div>
                    <div>
                         <div class="btn-group m-l-sm hidden-btn-group">

                            <button class="btn btn-grey btn-sm" ng-model="filter.date" uib-btn-radio="'all'" ng-click="loadHistory()"
                                    ng-class="{'btn-primary': filter.date=='all'}" translate>button.all
                            </button>
                            <button class="btn btn-grey btn-sm" ng-model="filter.date" ng-click="loadHistory()" uib-btn-radio="'1h'"
                                    ng-class="{'btn-primary': filter.date=='1h'}" translate>button.last1
                            </button>
                            <button class="btn btn-grey btn-sm" ng-model="filter.date" uib-btn-radio="'12h'" ng-click="loadHistory()"
                                    ng-class="{'btn-primary': filter.date=='12h'}" translate>button.last12
                            </button>
                            <button class="btn btn-grey btn-sm" ng-model="filter.date" ng-click="loadHistory()" uib-btn-radio="'1d'"
                                    ng-class="{'btn-primary': filter.date=='1d'}" translate>button.last24
                            </button>
                             <button class="btn btn-grey btn-sm" ng-model="filter.date" ng-click="loadHistory()" uib-btn-radio="'1w'"
                                    ng-class="{'btn-primary': filter.date=='1w'}" translate>button.lastWeak
                            </button>
                        </div>
                        <div class="btn-group dropdown hidden-dropdown">
                            <button class="btn btn-grey btn-sm m-l-sm dropdown-toggle" data-toggle="dropdown" translate>label.anyDate</button>
                            <div class="dropdown-menu dropdown-menu-scale dropdown-ac dropdown-more pull-right">
                                <a class="dropdown-item" ng-model="filter.date" uib-btn-radio="'all'" ng-click="loadHistory()"
                                        ng-class="{'btn-primary': filter.date=='all'}" translate>button.all
                                </a>
                                <a class="dropdown-item" ng-model="filter.date" ng-click="loadHistory()" uib-btn-radio="'1h'"
                                        ng-class="{'btn-primary': filter.date=='1h'}" translate>button.last1
                                </a>
                                <a class="dropdown-item" ng-model="filter.date" uib-btn-radio="'12h'" ng-click="loadHistory()"
                                        ng-class="{'btn-primary': filter.date=='12h'}" translate>button.last12
                                </a>
                                <a class="dropdown-item" ng-model="filter.date" ng-click="loadHistory()" uib-btn-radio="'1d'"
                                        ng-class="{'btn-primary': filter.date=='1d'}" translate>button.last24
                                </a>
                                <a class="dropdown-item" ng-model="filter.date" ng-click="loadHistory()" uib-btn-radio="'1w'"
                                        ng-class="{'btn-primary': filter.date=='1w'}" translate>button.lastWeak
                                </a>
                            </div>
                        </div>
                        <div class="btn-group dropdown m-r-sm" ng-show="filter.type == 'jobChain'">
                            <button class="btn btn-grey btn-sm m-l-sm dropdown-toggle" data-toggle="dropdown">{{'label.filters' | translate}} <span class="text-primary" ng-bind="savedHistoryFilter.selected"></span></button>
                            <div class="dropdown-menu dropdown-ac dropdown-more pull-right">
                                <a class="dropdown-item" href ng-click="advanceFilter()" translate>label.createFilter</a>
                                <a class="dropdown-item" href ng-click="editFilters()" ng-if="savedHistoryFilter.list.length>0" translate>label.editExistingFilters</a>
                                <div class="dropdown-divider" ng-if="savedHistoryFilter.list.length>0"></div>
                                <a class="dropdown-item" ng-class="{orange: savedHistoryFilter.selected == filter.name}" ng-click="changeFilter(filter)" ng-repeat="filter in savedHistoryFilter.list track by $index">
                                    {{filter.name}} <i ng-click="changeFilter();$event.stopPropagation();" ng-if="savedHistoryFilter.selected == filter.name" class="fa fa-times-circle-o remove"></i>
                                </a>
                            </div>
                        </div>
                        <div class="btn-group dropdown m-r-sm" ng-show="filter.type == 'job'">
                            <button class="btn btn-grey btn-sm m-l-sm dropdown-toggle" data-toggle="dropdown">{{'label.filters' | translate}} <span class="text-primary" ng-bind="savedJobHistoryFilter.selected"></span></button>
                            <div class="dropdown-menu dropdown-ac dropdown-more pull-right">
                                <a class="dropdown-item" href ng-click="advanceFilter()" translate>label.createFilter</a>
                                <a class="dropdown-item" href ng-click="editFilters()" ng-if="savedJobHistoryFilter.list.length>0" translate>label.editExistingFilters</a>
                                <div class="dropdown-divider" ng-if="savedJobHistoryFilter.list.length>0"></div>
                                <a class="dropdown-item" ng-class="{orange: savedJobHistoryFilter.selected == filter.name}" ng-click="changeFilter(filter)" ng-repeat="filter in savedJobHistoryFilter.list track by $index">
                                    {{filter.name}} <i ng-click="changeFilter();$event.stopPropagation();" ng-if="savedJobHistoryFilter.selected == filter.name" class="fa fa-times-circle-o remove"></i>
                                </a>
                            </div>
                        </div>
                        <button class="btn btn-grey btn-sm " id="exportToExcelBtn" ng-click="exportToExcel()"><img src="images/share.png" class="p-b-xs"> </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="scroll-y max-ht">
    <div class="padding p-b-0" >
        <div class="row m-b">
                 <div class="col-md-12">
                     <ul class="nav navbar-nav navbar-nav-inline nav-active-border nav-active-border2 b-primary">
                         <li class="nav-item">
                            <a class="nav-link" ng-class="{'active': filter.type=='jobChain'}" ng-model="filter.type"
                                        uib-btn-radio="'jobChain'">
                                <span class="nav-text text-dark p-b-sm"><span class="" translate>button.jobChain</span></span>
                            </a>
                        </li>
                         <li class="nav-item dropdown-separator">
                            <span class="separator"></span>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" ng-class="{'active': filter.type=='job'}" ng-model="filter.type"
                                        uib-btn-radio="'job'" ng-click="jobHistory()">
                                <span class="nav-text text-dark p-b-sm"><span class="" translate>button.job</span></span>
                            </a>
                        </li>
                     </ul>

                </div>
        </div>
        <div class="hide"  ng-class="{'show': isLoading}">
            <div class="m-t-sm box p-a" ng-show="filter.type == 'jobChain'" >
                <div class="table-responsive">
                    <table class="table table-hover table-bordered " id="jobChain" >
                        <thead>
                            <tr>
                                <th ng-click="sortBy('orderId')"><a><span translate>label.orderId</span>
                                    <i ng-show="filter.sortBy == 'orderId' && !sortReverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="filter.sortBy == 'orderId' && sortReverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('jobChain')"><a><span translate>label.jobChain</span>
                                    <i ng-show="filter.sortBy == 'jobChain' && !sortReverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="filter.sortBy == 'jobChain' && sortReverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('state._text')"><a><span translate>label.status</span>
                                    <i ng-show="filter.sortBy == 'state._text' && !sortReverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="filter.sortBy == 'state._text' && sortReverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('startTime')"><a><span translate>label.startTime</span>
                                    <i ng-show="filter.sortBy == 'startTime' && !sortReverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="filter.sortBy == 'startTime' && sortReverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('endTime')"><a><span translate>label.endTime</span>
                                    <i ng-show="filter.sortBy == 'endTime' && !sortReverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="filter.sortBy == 'endTime' && sortReverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('duration')">
                                    <a><span translate>label.duration</span>
                                    <i ng-show="filter.sortBy == 'duration' && !sortReverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="filter.sortBy == 'duration' && sortReverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('node')"><a><span translate>label.endNode</span>
                                    <i ng-show="filter.sortBy == 'node' && !sortReverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="filter.sortBy == 'node' && sortReverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th class="noExl"></th>
                            </tr>
                        </thead>
                        <tbody >
                        <tr ng-repeat="history in historys | orderBy: filter.sortBy | startFrom:(currentPage - 1) * pageSize | limitTo: pageSize">
                            <td>
                                <a ng-click="showLogWindow(history,null)" href="" ng-bind="history.orderId"></a>
                            </td>
                            <td ng-bind="history.jobChain"></td>
                            <td ><span uib-tooltip="{{history.error}}" class="label" ng-class="bgColorFunction(history.state.severity)" ng-bind="history.state._text | translate"></span></td>
                            <td ng-bind="history.startTime | stringToDate"></td>
                            <td ng-bind="history.endTime | stringToDate"></td>
                            <td ng-bind="history.startTime | duration:history.endTime"></td>
                            <td ng-bind="history.node || '-' "></td>
                            <td class="noExl">
                                <div class="btn-group dropdown">
                                    <button type="button" class="btn-drop more-option-h"  data-toggle="dropdown" ><i
                                            class="fa fa-ellipsis-h"></i></button>
                                    <div class="dropdown-menu dropdown-ac dropdown-more pull-left m-r-28" role="menu">
                                        <a class="dropdown-item" target="_blank" href="#/order/log/{{history.historyId}}/{{history.orderId}}?jobChain={{history.jobChain}}" translate>button.showLogInNewTab</a>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <div ng-if="isLoading && historys.length==0" class="text-center m-t-md h6 text-uppercase" translate>message.noOrderHistoryFound</div>
                    <ul ng-show="historys.length > pageSize" uib-pagination total-items="historys.length" ng-model="currentPage" items-per-page='pageSize' ng-change="pageChange()" class="pagination-sm m-t-0" max-size="5" boundary-link-numbers="true" rotate="false" previous-text="{{'button.prev' | translate}}" next-text="{{'button.next' | translate}}"></ul>
                    <div class="pull-right" ng-show="historys.length > 10">
                            <div class="btn-group m-r-xxs">
                                <button class="btn btn-default white btn-sm" ng-model="pageSize" uib-btn-radio="'10'"
                                        ng-class="{'primary': pageSize=='10'}" >10
                                </button>
                                <button class="btn btn-default white btn-sm" ng-model="pageSize" uib-btn-radio="'25'"
                                        ng-class="{'primary': pageSize=='25'}" >25
                                </button>
                                <button class="btn btn-default white btn-sm" ng-model="pageSize" uib-btn-radio="'50'"
                                        ng-class="{'primary': pageSize=='50'}" >50
                                </button>
                                <button class="btn btn-default white btn-sm" ng-model="pageSize" uib-btn-radio="'100'"
                                        ng-class="{'primary': pageSize=='100'}">100
                                </button>
                            </div>
                    </div>
                </div>
            </div>
            <div class="m-t-sm box p-a" ng-show="filter.type == 'job'">
                <div class="table-responsive">
                    <table class="table table-hover table-bordered " id="job">
                        <thead>
                            <tr>
                                <th ng-click="sortBy('taskId')"><a><span translate>label.taskId</span>
                                    <i ng-show="filter.sortBy == 'taskId' && !sortReverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="filter.sortBy == 'taskId' && sortReverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('job')"><a><span translate>label.job</span>
                                    <i ng-show="filter.sortBy == 'job' && !sortReverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="filter.sortBy == 'job' && sortReverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('state._text')"><a><span translate>label.status</span>
                                    <i ng-show="filter.sortBy == 'state._text' && !sortReverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="filter.sortBy == 'state._text' && sortReverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('agent')"><a><span translate>label.processedBy </span>
                                    <i ng-show="filter.sortBy == 'agent' && !sortReverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="filter.sortBy == 'agent' && sortReverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('startTime')"><a><span translate>label.startTime</span>
                                    <i ng-show="filter.sortBy == 'startTime' && !sortReverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="filter.sortBy == 'startTime' && sortReverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('endTime')"><a><span translate>label.endTime</span>
                                    <i ng-show="filter.sortBy == 'endTime' && !sortReverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="filter.sortBy == 'endTime' && sortReverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('duration')">
                                    <a><span translate>label.duration</span>
                                    <i ng-show="filter.sortBy == 'duration' && !sortReverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="filter.sortBy == 'duration' && sortReverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('exitCode')"><a><span translate>label.exitCode</span>
                                    <i ng-show="filter.sortBy == 'exitCode' && !sortReverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="filter.sortBy == 'exitCode' && sortReverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th class="noExl"></th>
                            </tr>
                        </thead>
                        <tbody>
                        <tr  ng-repeat="jobHistory in jobHistorys| orderBy: filter.sortBy | startFrom:(currentPage - 1) * pageSize | limitTo: pageSize">

                            <td>
                                <a ng-click="showLogWindow(null,jobHistory)" href="" ng-bind="jobHistory.taskId"></a>
                            </td>
                            <td ng-bind="jobHistory.job"></td>
                            <td><span uib-tooltip="{{history.error}}" class="label" ng-class="bgColorFunction(jobHistory.state.severity)" ng-bind="jobHistory.state._text | translate"></span></td>
                            <td><a class="text-primary" target="_blank" href="{{jobHistory.agent}}" ng-bind="jobHistory.agent"></a></td>
                            <td ng-bind="jobHistory.startTime | stringToDate"></td>
                            <td ng-bind="jobHistory.endTime | stringToDate"></td>
                            <td ng-bind="jobHistory.startTime | duration:jobHistory.endTime"></td>
                            <td ng-bind="jobHistory.exitCode"></td>
                            <td class="noExl">
                                <div class="btn-group dropdown">
                                    <button type="button" class="btn-drop more-option-h"  data-toggle="dropdown" ><i
                                            class="fa fa-ellipsis-h"></i></button>
                                    <div class="dropdown-menu dropdown-ac dropdown-more pull-left m-r-28" role="menu">
                                        <a class="dropdown-item" target="_blank" href="#/job/log/{{jobHistory.taskId}}?job={{jobHistory.job}}" translate>button.showLogInNewTab</a>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <div ng-if="isLoading && jobHistorys.length==0" class="text-center m-t-md h6 text-uppercase" translate>message.noJobhistoryFound</div>

                     <ul ng-show="jobHistorys.length > pageSize" uib-pagination total-items="jobHistorys.length" ng-model="currentPage" ng-change="pageChange()" items-per-page='pageSize' class="pagination-sm m-t-0" max-size="5" boundary-link-numbers="true" rotate="false" previous-text="{{'button.prev' | translate}}" next-text="{{'button.next' | translate}}"></ul>
                    <div class="pull-right" ng-show="jobHistorys.length > 10">
                            <div class="btn-group m-r-xxs">
                                <button class="btn btn-default white btn-sm" ng-model="pageSize" uib-btn-radio="'10'"
                                        ng-class="{'primary': pageSize=='10'}" >10
                                </button>
                                <button class="btn btn-default white btn-sm" ng-model="pageSize" uib-btn-radio="'25'"
                                        ng-class="{'primary': pageSize=='25'}" >25
                                </button>
                                <button class="btn btn-default white btn-sm" ng-model="pageSize" uib-btn-radio="'50'"
                                        ng-class="{'primary': pageSize=='50'}" >50
                                </button>
                                <button class="btn btn-default white btn-sm" ng-model="pageSize" uib-btn-radio="'100'"
                                        ng-class="{'primary': pageSize=='100'}">100
                                </button>
                            </div>
                    </div>
                </div>
            </div>
        </div>
        <div  ng-if="!isLoading" class="text-center m-t-lg" >
            <div class="cssload-loading">{{'label.loading' | translate}}...</div>
        </div>
    </div>
</div>

<div class="modal fade" id="treeModal" tabindex="-1" role="dialog" aria-labelledby="user" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body p-a" style="height: 550px; overflow: auto">
                <div>
                    <button class="btn btn-grey btn-sm" ng-click="filter_tree.expand_all();expandAll();" >
                        <i class="fa fa-angle-down fa-lg"></i>
                        <span translate>button.expandAll</span>
                    </button>
                    <button class="btn btn-grey btn-sm m-l-xs" ng-click="filter_tree.collapse_all();" >
                       <i class="fa fa-angle-up fa-lg"></i>
                        <span translate>button.collapseAll</span>
                    </button>
                    <tree
                            tree-data="tree"
                            tree-control="filter_tree"
                            expand-to="expand_to"
                            object="object"
                            expand-level="2"
                            icon-leaf     = "fa fa-folder"
                            icon-expand   = "fa fa-folder"
                            icon-collapse = "fa fa-folder-open"
                            expand-on="expanding_property"
                            on-select="treeExpand(branch)"
                            on-click="treeExpand(branch)"
                            template-url="modules/core/template/tree-filter-structure.html">
                    </tree>
                </div>
            </div>
            <div class="modal-footer ">
                <button type="button" class="btn btn-primary btn-sm pull-left" ng-click="addJobChainPaths()" data-dismiss="modal" translate>button.done</button>
                <button type="button" class="btn btn-grey btn-sm pull-left" data-dismiss="modal" translate>button.cancel</button>
            </div>
        </div>
    </div>
</div>
