<div class="hide-block sidebar-btn resize-cursor">
    <i class="fa fa-angle-double-right p-l-sm" ng-click="showLeftPanel()"></i>
</div>
<div id="leftPanel" class="leftPanel" resizable r-directions="['right']" r-width="270">
    <div>
        <button class="btn btn-grey btn-sm" ng-click="my_tree.expand_all();expandAll();" >
            <i class="fa fa-angle-down fa-lg"></i>
            <span translate>button.expandAll</span>
        </button>
        <button class="btn btn-grey btn-sm m-l-xs" ng-click="my_tree.collapse_all();" >
            <i class="fa fa-angle-up fa-lg"></i>
            <span translate>button.collapseAll</span>
        </button>
        <a class="text m-l-xs resize-cursor"><i class="fa fa-angle-double-left fa-lg" ng-click="hidePanel()"></i></a>
        <tree tree-data="tree"
              tree-control="my_tree"
              expand-to="expand_to"
              expand-on="expanding_property1"
              on-select="treeHandler1(branch)"
              on-click="treeHandler(branch)"
              expand-node="expandNode(branch)"
              collapse-node="collapseNode(branch)"
              template-url="modules/jobscheduler/views/schedule-tree.html">
        </tree>
    </div>
</div>
<div id="rightPanel1">
    <div class="hide" ng-class="{'show': isLoading && permission.JobschedulerMasterCluster.view.clusterStatus}">
        <div class="hide row" ng-class="{'show': pageView=='grid'}">
             <div ng-repeat="branch in branchs">
                  <div class="col-sm-12" ng-if="branch.path" style="margin-bottom: 10px">
                      <span class="text inline"><i class="fa fa-folder-o"></i> {{::branch.path}}</span>
                  </div>
                  <div class="col-xxl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12"  ng-repeat="schedule in filtered = (branch.schedules | filter: filterString:strict)">
                            <div class="box card">
                                <div class="box-body">

                                    <div>
                                        <label class="md-check pos-abt">
                                            <input type="checkbox" data-checklist-model="object.schedules" data-checklist-value="schedule"><i
                                                class="primary"></i></label>

                                        <div class="text-left m-l-md block-ellipsis" >
                                             <span uib-tooltip="{{schedule.title}}" ng-bind="schedule.name"></span>
                                            <span class="fa fa-stop text-xs" ng-class="colorFunction(schedule.state.severity)"></span>
                                        </div>
                                        <div class="btn-group dropdown pull-right abt-dropdown ">
                                            <a href class=" more-option text-black-lt" data-toggle="dropdown"><i
                                                    class="text fa fa-ellipsis-v"></i></a>

                                            <div class="dropdown-menu dropdown-ac dropdown-more">
                                                <a ng-click="showConfiguration('schedule',schedule.path,schedule.name)" class="hide dropdown-item" ng-class="{show:permission.Schedule.view.configuration}" translate>button.showConfiguration</a>
                                                <a class="dropdown-item" ng-click="substitute(schedule)" translate>button.substitute</a>
                                                <a class="dropdown-item" ng-click="editSchedule(schedule)" translate>button.editSchedule</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-sm text-left text-muted p-t-sm">
                                        <span translate>label.validity </span>:
                                        <span ng-bind="'-'"></span>
                                    </div>
                                     <div class="text-sm text-left text-muted p-t-sm">
                                        <span translate>label.noOfOrders </span>:
                                        <a href="#/schedule/{{schedule.name}}?path={{schedule.path}}" class="text-dark primary-text-hover-color" ng-bind="schedule.usedByOrders.length || 0"></a>
                                    </div>
                                    <div class="text-sm text-left text-muted p-t-sm">
                                        <span translate>label.noOfJobs </span>:
                                        <a class="text-dark primary-text-hover-color" ng-bind="schedule.usedByJobs.length || 0"></a>
                                    </div>
                                </div>
                                <div class="box-footer b-t">
                                    <div>
                                        <a href class="text-left primary-text-hover-color" ng-click="substitute(schedule)"><i class="fa fa-repeat text-black-lt"></i> <span class="text-black-lt" translate>button.substitute</span></a>
                                        <a href class="pull-right primary-text-hover-color" ng-click="editSchedule(schedule)"><i class="fa fa-pencil text-black-lt"></i> <span class="text-black-lt" translate>button.editSchedule</span></a>
                                    </div>
                                </div>
                            </div>
                        </div>
              </div>
         </div>
        <div class="box p-a" ng-show="pageView=='list' && branchs.length>0">
            <div class="table-responsive" >
                <table class="table table-hover table-bordered  ">
                    <thead>
                            <tr>
                                <th>
                                    <label class="md-check lg-check">
                                        <input type="checkbox" ng-model="allCheck.checkbox" ng-click="checkAll()"><i class="primary"></i>
                                    </label>
                                </th>
                                <th ng-click="sortBy('name')"><a><span translate>label.scheduleName</span>
                                    <i ng-show="propertyName == 'name' && !reverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="propertyName == 'name' && reverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('path')"><a><span translate>label.path</span>
                                    <i ng-show="propertyName == 'path' && !reverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="propertyName == 'path' && reverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('state._text')"><a><span translate>label.state</span>
                                    <i ng-show="propertyName == 'state._text' && !reverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="propertyName == 'state._text' && reverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('usedByOrders.length')"><a><span translate>label.usedByOrders</span>
                                    <i ng-show="propertyName == 'usedByOrders.length' && !reverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="propertyName == 'usedByOrders.length' && reverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th ng-click="sortBy('usedByJobs.length')"><a><span translate>label.usedByJobs</span>
                                    <i ng-show="propertyName == 'usedByJobs.length' && !reverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="propertyName == 'usedByJobs.length' && reverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                  <th ng-click="sortBy('validityFrom')"><a><span translate>label.validityFrom</span>
                                    <i ng-show="propertyName == 'validityFrom' && !reverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="propertyName == 'validityFrom' && reverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                  <th ng-click="sortBy('validityTo')"><a><span translate>label.validityTo</span>
                                    <i ng-show="propertyName == 'validityTo' && !reverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="propertyName == 'validityTo' && reverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                 <th ng-click="sortBy('subsituteBy')"><a><span translate>label.substituteBy</span>
                                    <i ng-show="propertyName == 'subsituteBy' && !reverse"
                                       class="fa fa-caret-down "></i>
                                    <i ng-show="propertyName == 'subsituteBy' && reverse"
                                       class="fa fa-caret-up "></i></a>
                                </th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="schedule in filtered = (allSchedules | filter: filterString:strict) | startFrom:(currentPage - 1) * pageSize|limitTo: pageSize">
                                <td>
                                    <label class="md-check">
                                        <input type="checkbox" data-checklist-model="object.schedules" data-checklist-value="schedule"><i class="primary"></i>
                                    </label>
                                </td>
                                <td >{{schedule.name}}
                                    <span ng-if="schedule.title">-</span>
                                    <i class="text-muted" ng-bind-html="schedule.title"></i>
                                </td>
                                <td ng-bind="schedule.path"></td>
                                 <td><span class="text-c label" ng-class="bgColorFunction(schedule.state.severity)" ng-bind="schedule.state._text  | translate" ></span></td>
                                <td><a href="#/schedule/{{schedule.name}}?path={{schedule.path}}" ng-bind="schedule.usedByOrders.length || 0"></a></td>
                                <td><a href="#/schedule/{{schedule.name}}?path={{schedule.path}}" ng-bind="schedule.usedByJobs.length || 0"></a></td>
                                <td ng-bind="schedule.validityFrom || 'never'"></td>
                                <td ng-bind="schedule.validityTo || 'never'"></td>
                                <td ng-bind="schedule.subsituteBy || 'never'"></td>
                                <td>
                                    <div class="btn-group dropdown">
                                    <a class="more-option-h" href data-toggle="dropdown"><i class="fa fa-ellipsis-h"></i></a>
                                    <div class="dropdown-menu dropdown-ac dropdown-more pull-left m-r-28" role="menu">
                                        <a ng-click="showConfiguration('schedule',schedule.path,schedule.name)" class="hide dropdown-item" ng-class="{show:permission.Schedule.view.configuration}" translate>button.showConfiguration</a>
                                        <a class="dropdown-item" ng-click="substitute(schedule)" translate>button.substitute</a>
                                        <a class="dropdown-item" ng-click="editSchedule(schedule)" translate>button.editSchedule</a>
                                    </div>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                <ul ng-show="filtered.length > pageSize" uib-pagination total-items="filtered.length" ng-model="currentPage" items-per-page='pageSize' class="pagination-sm m-t-0" max-size="5" ng-change="pageChange()" boundary-link-numbers="true" rotate="false" previous-text="{{'button.prev' | translate}}" next-text="{{'button.next' | translate}}"></ul>
                <div class="pull-right" ng-show="filtered.length > 10">
                            <div class="btn-group m-r-xxs">
                                <button class="btn btn-default white btn-sm" ng-model="pageSize" uib-btn-radio="'10'"
                                        ng-class="{'primary': pageSize=='10'}" >10
                                </button>
                                <button class="btn btn-default white btn-sm" ng-model="pageSize" uib-btn-radio="'25'"
                                        ng-class="{'primary': pageSize=='25'}" >25
                                </button>
                                <button class="btn btn-default white btn-sm" ng-model="pageSize" uib-btn-radio="'50'"
                                        ng-class="{'primary': pageSize=='50'}" >50
                                </button>
                                <button class="btn btn-default white btn-sm" ng-model="pageSize" uib-btn-radio="'100'"
                                        ng-class="{'primary': pageSize=='100'}">100
                                </button>
                            </div>
                        </div>
                <div class="text-center m-t text-uppercase hide text-orange" ng-class="{'show': (filtered.length===0 && allSchedules.length !==0)}" translate>message.noDataMatched</div>
            </div>
        </div>
        <div ng-if="isLoading && branchs.length==0" class="text-center m-t h6 text-uppercase" translate>message.noScheduleFound</div>
    </div>
    <div ng-if="!isLoading" class="text-center m-t-lg">
        <div class="cssload-loading">{{'label.loading' | translate}}...</div>
    </div>
</div>

<script>
    $('.table-responsive').on('shown.bs.dropdown', function (e) {
    var $table = $(this),
        $menu = $(e.target).find('.dropdown-menu'),
        tableOffsetHeight = $table.offset().top + $table.height(),
        menuOffsetHeight = $menu.offset().top + $menu.outerHeight(true);

    if (menuOffsetHeight > tableOffsetHeight)
      $table.css("padding-bottom", menuOffsetHeight - tableOffsetHeight +10);
  });

  $('.table-responsive').on('hide.bs.dropdown', function () {
    $(this).css("padding-bottom", 0);
  });

      $(document).ready(function () {
      $('#leftPanel').stickySidebar({
            sidebarTopMargin: 190
        });
  });
</script>
